<?xml version="1.0" encoding="UTF-8" ?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Adds a fault log to system if the flow fails to get the latest address record.</description>
        <name>Fail_to_Get_Latest_Address_Record</name>
        <label>Fail to Get Latest  Address Record</label>
        <locationX>1018</locationX>
        <locationY>1037</locationY>
        <actionName>FlowLogEntry</actionName>
        <actionType>apex</actionType>
        <connector>
            <isGoTo>true</isGoTo>
            <targetReference>Save_Fault_log</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>faultMessage</name>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>flowName</name>
            <value>
                <stringValue>PC_User_Before_CreatUpdate</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>message</name>
            <value>
                <stringValue>Failed to get Address record by using prc user record&apos;s current location field.</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recordId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>FlowLogEntry</nameSegment>
        <storeOutputAutomatically>true</storeOutputAutomatically>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Adds a fault log to system if the flow fails to get the latest VAF address record.</description>
        <name>Fail_to_Get_Latest_VAF_Address_Record</name>
        <label>Fail to Get Latest VAF Address Record</label>
        <locationX>1282</locationX>
        <locationY>431</locationY>
        <actionName>FlowLogEntry</actionName>
        <actionType>apex</actionType>
        <connector>
            <isGoTo>true</isGoTo>
            <targetReference>Save_Fault_log</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>faultMessage</name>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>flowName</name>
            <value>
                <stringValue>PC_User_Before_CreatUpdate</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>message</name>
            <value>
                <stringValue>Failed to get VAF Address record by using prc user current location</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recordId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>FlowLogEntry</nameSegment>
        <storeOutputAutomatically>true</storeOutputAutomatically>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Adds a fault log to the system if the flow fails to update the Location_Address2__c field on the PrC User record.</description>
        <name>Fail_to_update_Location_Address2_field_at_Prc_User_Record</name>
        <label>Fail to update Location_Address2__c field at Prc User Record</label>
        <locationX>754</locationX>
        <locationY>1145</locationY>
        <actionName>FlowLogEntry</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Save_Fault_log</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>faultMessage</name>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>flowName</name>
            <value>
                <stringValue>PC_User_Before_CreatUpdate</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>message</name>
            <value>
                <stringValue>Failed to update Location_Address2__c field on the Prc User record </stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recordId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>FlowLogEntry</nameSegment>
        <storeOutputAutomatically>true</storeOutputAutomatically>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Adds a fault log to the system if the flow fails to update the Location_Address__c field on the PrC User record.</description>
        <name>Fail_to_update_Location_address_c_field_at_Prc_User_record</name>
        <label>Fail to update Location_address__c field at Prc User record</label>
        <locationX>314</locationX>
        <locationY>647</locationY>
        <actionName>FlowLogEntry</actionName>
        <actionType>apex</actionType>
        <connector>
            <isGoTo>true</isGoTo>
            <targetReference>Save_Fault_log</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>faultMessage</name>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>flowName</name>
            <value>
                <stringValue>PC_User_Before_CreatUpdate</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>message</name>
            <value>
                <stringValue>Failed to update field Location_Address__c  field on the Prc_User record.</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recordId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>FlowLogEntry</nameSegment>
        <storeOutputAutomatically>true</storeOutputAutomatically>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Adds a fault log to system if the flow fails.</description>
        <name>Save_Fault_log</name>
        <label>Save Fault log</label>
        <locationX>754</locationX>
        <locationY>1253</locationY>
        <actionName>Logger</actionName>
        <actionType>apex</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <nameSegment>Logger</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <apiVersion>60.0</apiVersion>
    <decisions>
        <description>IS VAF Address present? If Yes then Location_Address__c field will be updated with the VAF Address Id else the flow will update Location_Address2__c field with the Address object record id. Flow will Get the Latest Address information from Address object based on Prc_User record&apos;s current location. Flow will get the recently created Address record by sorting the record based on created date and update the Location_Address2__c field.</description>
        <name>Is_VAF_Address_present</name>
        <label>Is VAF Address present</label>
        <locationX>314</locationX>
        <locationY>431</locationY>
        <defaultConnector>
            <targetReference>Get_Latest_Address_Information</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>VAF Address is not present</defaultConnectorLabel>
        <rules>
            <name>VAF_Address_Present</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Latest_VAF_Address_Information</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Location_Address_of_Prc_User_Record</targetReference>
            </connector>
            <label>VAF Address Present</label>
        </rules>
    </decisions>
    <description>Update Location_Address__c field on PrC User record based on the current location field value present in the PrC User object. Location_Address__c is a lookup field to VAF Address object. If VAF Address data is not available for the current location address then Location_Address2__c field on PrC User record will be populated based on the current location field value present in the PrC User object. Location_Address2__c is a lookup field to Address object. This is a record trigger flow and it will run before update and before insert scenarios.</description>
    <environments>Default</environments>
    <interviewLabel>PC User Before Create Update {!$Flow.CurrentDateTime}</interviewLabel>
    <label>PC User Before Create Update</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <description>Get the latest Address information from Address object based on Prc_User record&apos;s current location. This node will get the recently created Address record by sorting the record based on created date.</description>
        <name>Get_Latest_Address_Information</name>
        <label>Get Latest Address Information</label>
        <locationX>314</locationX>
        <locationY>929</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Update_Location_Address2_of_Prc_User_Record</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Fail_to_Get_Latest_Address_Record</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ParentId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Current_Location__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>VAF_Is_Decommissioned__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>VAF_Latitude__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>VAF_Longitude__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>AddressType</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Physical</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Address</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get the latest VAF Address information from VAF_Address object based on Prc_User record&apos;s current location. This node will get the recently created Address record by sorting the record based on created date.</description>
        <name>Get_Latest_VAF_Address_Information</name>
        <label>Get Latest VAF Address Information</label>
        <locationX>314</locationX>
        <locationY>323</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Is_VAF_Address_present</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Fail_to_Get_Latest_VAF_Address_Record</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>VAF_Facility__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Current_Location__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>VAF_Is_Decommissioned__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>VAF_Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Physical</stringValue>
            </value>
        </filters>
        <filters>
            <field>VAF_Latitude__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>VAF_Longitude__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>VAF_Address__c</object>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <description>Update Prc_User record&apos;s Location Address2 field with latest Address id received from previous node - &quot;Get Latest Address Information&quot;</description>
        <name>Update_Location_Address2_of_Prc_User_Record</name>
        <label>Update Location Address2 of Prc User Record</label>
        <locationX>314</locationX>
        <locationY>1037</locationY>
        <faultConnector>
            <targetReference>Fail_to_update_Location_Address2_field_at_Prc_User_Record</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>Location_Address2__c</field>
            <value>
                <elementReference>Get_Latest_Address_Information.Id</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <description>Update Prc_User record&apos;s Location Address field with latest VAF Address id received from previous node - &quot;Get Latest VAF Address Information&quot;</description>
        <name>Update_Location_Address_of_Prc_User_Record</name>
        <label>Update Location Address of Prc User Record</label>
        <locationX>50</locationX>
        <locationY>539</locationY>
        <connector>
            <targetReference>Get_Latest_Address_Information</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Fail_to_update_Location_address_c_field_at_Prc_User_record</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Location_Address__c</field>
            <value>
                <elementReference>Get_Latest_VAF_Address_Information.Id</elementReference>
            </value>
        </inputAssignments>
        <object>PC_User__c</object>
    </recordUpdates>
    <start>
        <locationX>188</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Latest_VAF_Address_Information</targetReference>
        </connector>
        <filterFormula>AND({!$Permission.DisableTriggersFlag}==false,
OR(ISNEW() ,  ISCHANGED({!$Record.Current_Location__c}) )
)</filterFormula>
        <object>PC_User__c</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
</Flow>
